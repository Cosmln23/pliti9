"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[582],{4207:function(e,t,s){var a=s(3827),r=s(4090),l=s(7366),i=s(4059),n=s(9990);t.Z=e=>{let{isStreamerView:t=!1,streamId:s="plipli9-paranormal-live",viewerCount:c=0}=e,[o,u]=(0,r.useState)([]),[m,d]=(0,r.useState)(""),[x,p]=(0,r.useState)(""),[h,g]=(0,r.useState)(t),[D,f]=(0,r.useState)(!0),[b,j]=(0,r.useState)(!1),[y,v]=(0,r.useState)(!1),[N,w]=(0,r.useState)(!1),C=(0,r.useRef)(null);(0,r.useRef)(null);let S=(0,r.useRef)(null),k=e=>{d(t=>t+e),j(!1)},E=()=>{var e;null===(e=C.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,r.useEffect)(()=>{E()},[o]),(0,r.useEffect)(()=>{if(!t&&!x){let e=["Ghost","Spirit","Shadow","Mystery","Phantom","Seeker","Explorer","Hunter","Believer","Curious","Watcher","Guest"],t=e[Math.floor(Math.random()*e.length)];p("".concat(t).concat(Math.floor(999*Math.random())+1))}},[]),(0,r.useEffect)(()=>{if(!s||!h)return;let e=3e3,t=0,a=0,r=null,l=async()=>{try{let r=await fetch("/api/chat/messages?streamId=".concat(s,"&t=").concat(Date.now()));if(r.ok){let s=await r.json();s.messages&&(s.messages.length>t?(e=Math.max(2e3,e-500),a=0):++a>3&&(e=Math.min(1e4,e+1e3)),t=s.messages.length,u(e=>{let t=s.messages,a=e.filter(e=>e.id.startsWith("temp-")).filter(e=>!t.some(t=>t.username===e.username&&t.message===e.message&&1e4>Math.abs(new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime())));return[...t,...a]}),f(!0),console.log("\uD83D\uDCF1 Smart chat poll: ".concat(s.messages.length," messages (interval: ").concat(e,"ms)")))}else console.error("Failed to fetch messages:",r.status),f(!1),e=Math.min(8e3,e+1e3)}catch(t){console.error("❌ Mobile polling error:",t),f(!1),e=Math.min(8e3,e+1e3)}},i=()=>{r=setTimeout(()=>{l().then(i)},e)};return l().then(i),()=>{r&&clearTimeout(r)}},[s,h]);let M=async()=>{if(!m.trim()||!s||y)return;v(!0);let e=m.trim(),a={id:"temp-".concat(Date.now()),username:x,message:e,timestamp:new Date().toISOString(),type:t?"admin":"user",likes:0};u(e=>[...e,a]),d("");try{let a=await fetch("/api/chat/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({streamId:s,username:x,message:e,isStreamer:t})});if(!a.ok)throw Error("HTTP ".concat(a.status));let r=await a.json();if(!r.success)throw Error(r.error||"Failed to send message");console.log("✅ Message sent successfully on mobile:",r),f(!0)}catch(t){console.error("❌ Mobile chat error:",t),f(!1),u(e=>e.filter(e=>e.id!==a.id)),d(e),alert("Mesajul nu a putut fi trimis. Verifică conexiunea și \xeencearcă din nou.")}finally{v(!1)}},F=e=>new Date(e).toLocaleTimeString("ro-RO",{hour:"2-digit",minute:"2-digit"});return h||t?(0,a.jsxs)("div",{className:"h-full flex flex-col bg-gray-900",children:[(0,a.jsxs)("div",{className:"border-b border-gray-800 p-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(l.Z,{className:"w-5 h-5 text-purple-400"}),(0,a.jsx)("h3",{className:"text-white font-semibold",children:"Chat Live"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-gray-400 text-sm",children:[(0,a.jsx)(i.Z,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:[c," spectatori"]}),t&&(0,a.jsx)("button",{onClick:()=>w(!N),className:"ml-2 px-2 py-1 bg-purple-600 hover:bg-purple-700 text-white text-xs rounded transition-colors",title:"Toggle Twitch Bridge",children:"\uD83C\uDFAE Twitch"})]})]}),N&&t&&(0,a.jsxs)("div",{className:"mt-3 p-3 bg-purple-900/30 border border-purple-600/30 rounded-lg",children:[(0,a.jsx)("div",{className:"flex items-center space-x-2 mb-2",children:(0,a.jsx)("span",{className:"text-purple-400 text-xs font-semibold",children:"\uD83C\uDFAE BRIDGE pentru Streamlabs/OBS"})}),(0,a.jsx)("div",{className:"space-y-1 max-h-20 overflow-y-auto text-xs",children:o.slice(-3).map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("span",{className:"text-purple-300",children:[e.username,":"]}),(0,a.jsx)("span",{className:"text-white flex-1",children:e.message}),(0,a.jsx)("button",{onClick:()=>{navigator.clipboard.writeText("".concat(e.username,": ").concat(e.message));let t=document.activeElement;t&&(t.textContent="✅",setTimeout(()=>{t.textContent="\uD83D\uDCCB"},1e3))},className:"text-purple-400 hover:text-purple-300 text-xs px-1",title:"Copy pentru Streamlabs",children:"\uD83D\uDCCB"})]},e.id))}),(0,a.jsx)("div",{className:"mt-2 text-xs text-purple-300",children:"\uD83D\uDCA1 Mesajele se copiază automat - paste \xeen Streamlabs pentru a le vedea \xeen live"})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-3 space-y-3 scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-transparent",children:[o.map(e=>(0,a.jsx)("div",{className:"group",children:(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full flex items-center justify-center text-white text-xs font-bold flex-shrink-0",children:e.username.slice(0,2).toUpperCase()}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,a.jsx)("span",{className:"text-purple-400 font-semibold text-sm",children:e.username}),(0,a.jsx)("span",{className:"text-gray-500 text-xs",children:F(e.timestamp)})]}),(0,a.jsx)("p",{className:"text-white text-sm break-words",children:e.message})]})]})},e.id)),0===o.length&&(0,a.jsxs)("div",{className:"text-center text-gray-400 py-8",children:[(0,a.jsx)(l.Z,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,a.jsx)("p",{className:"text-sm",children:"Fii primul care scrie \xeen chat!"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Folosește emoji-urile paranormale \uD83D\uDC7B"})]}),(0,a.jsx)("div",{ref:C})]}),(0,a.jsxs)("div",{className:"border-t border-gray-800 p-3",children:[b&&(0,a.jsxs)("div",{className:"mb-3 p-2 bg-gray-800 rounded-lg",children:[(0,a.jsx)("div",{className:"text-xs text-gray-400 mb-2",children:"Emoji paranormale:"}),(0,a.jsx)("div",{className:"grid grid-cols-8 gap-1",children:["\uD83D\uDC7B","\uD83D\uDC80","\uD83D\uDD2E","\uD83D\uDD6F️","\uD83C\uDF19","⚡","\uD83E\uDD87","\uD83D\uDD77️","\uD83D\uDD31","\uD83D\uDC9C","\uD83D\uDDA4","☠️","⚰️","\uD83C\uDF1F","✨","\uD83C\uDF0C","\uD83D\uDD6F️","\uD83D\uDD25","❄️","\uD83D\uDC8E","\uD83D\uDDDD️","\uD83D\uDCFF","\uD83D\uDD10","⚗️"].map((e,t)=>(0,a.jsx)("button",{onClick:()=>k(e),className:"text-lg hover:bg-gray-700 rounded p-1 transition-colors",title:"Adaugă ".concat(e),children:e},t))})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>j(!b),className:"px-3 py-2 bg-gray-800 hover:bg-gray-700 text-gray-300 rounded-lg transition-colors flex-shrink-0",title:"Emoji paranormale",children:"\uD83D\uDC7B"}),(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)("input",{ref:S,type:"text",value:m,onChange:e=>d(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),M())},placeholder:"Scrie un mesaj...",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-purple-500 transition-colors text-base",style:{fontSize:"16px"},maxLength:200,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:"false"}),(0,a.jsxs)("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500",children:[m.length,"/200"]})]}),(0,a.jsx)("button",{onClick:()=>{S.current&&S.current.blur(),M()},disabled:!m.trim()||y,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-700 disabled:cursor-not-allowed text-white rounded-lg transition-colors flex-shrink-0 touch-manipulation",style:{minHeight:"44px",minWidth:"44px"},children:y?(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):(0,a.jsx)(n.Z,{className:"w-4 h-4"})})]}),(0,a.jsxs)("div",{className:"mt-2 text-xs text-gray-500 text-center",children:[D?"Conectat":"Deconectat"," • Mesajele sunt live pentru toți spectatorii"]}),(0,a.jsx)("div",{className:"mt-1 text-xs text-gray-600 text-center",children:"⚠️ Anti-spam: max 4 caractere identice, 3s cooldown"})]})]}):(0,a.jsx)("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-6 h-96 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(l.Z,{className:"w-12 h-12 text-purple-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-bold text-white mb-4",children:"Alătură-te conversației"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("input",{type:"text",value:x,onChange:e=>p(e.target.value),placeholder:"Numele tău (opțional)",className:"w-full px-4 py-2 bg-gray-800 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-purple-500",maxLength:20}),(0,a.jsx)("button",{onClick:()=>g(!0),className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition-colors",children:"Intră \xeen Chat"})]})]})})}}}]);