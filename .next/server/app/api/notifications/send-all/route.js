"use strict";(()=>{var e={};e.id=7769,e.ids=[7769],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},41780:(e,t,o)=>{o.r(t),o.d(t,{headerHooks:()=>w,originalPathname:()=>g,patchFetch:()=>C,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>D});var s={};o.r(s),o.d(s,{POST:()=>c});var a=o(95419),r=o(69108),i=o(99678),n=o(78070);async function c(e){try{let t=await e.json();console.log("\uD83D\uDCF1 STARTING OPTIMIZED NOTIFICATION CHAIN"),console.log("\uD83D\uDCE7 Email:",t.email),console.log("\uD83D\uDCF1 Phone:",t.phoneNumber),console.log("\uD83D\uDD11 Code:",t.accessCode);let o=Date.now(),[s,a]=await Promise.allSettled([l(t),u(t)]),r={email:"fulfilled"===s.status?s.value:{success:!1,error:s.reason?.message||"Unknown error"},whatsapp:"fulfilled"===a.status?a.value:{success:!1,error:a.reason?.message||"Unknown error"}};console.log("\uD83D\uDCE7 Email result:",r.email.success?"✅ SUCCESS":"❌ FAILED"),console.log("\uD83D\uDCF1 WhatsApp result:",r.whatsapp.success?"✅ SUCCESS":"❌ FAILED"),p(t.stripePaymentId,r).catch(e=>{console.error("⚠️ Failed to update notification status:",e)});let i=Date.now()-o;return console.log(`📱 NOTIFICATION CHAIN COMPLETED in ${i}ms`),n.Z.json({success:!0,message:"Notification chain executed",results:r,primarySuccess:r.email.success,backupSuccess:r.whatsapp.success,executionTime:i,optimization:"parallel_execution"})}catch(e){return console.error("❌ Notification chain error:",e),n.Z.json({success:!1,error:"Notification chain failed",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function l(e){try{let t={email:e.email,accessCode:e.accessCode,amount:e.amount,phoneNumber:e.phoneNumber,expiresAt:e.expiresAt,liveUrl:"https://www.plipli9.com/live",timestamp:e.createdAt},o=await fetch("https://hook.eu2.make.com/4w78i9a1ckym4d0f2r6vg5pxbsqz3t7n",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(8e3)});if(!o.ok)throw Error(`Email webhook failed: ${o.status} ${o.statusText}`);let s=await o.text();return console.log("\uD83D\uDCE7 Email webhook response:",s),{success:!0,response:s}}catch(e){return console.error("❌ Email notification error:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function u(e){try{let t=`🎭 PARANORMAL ACCESS GRANTED!

Codul tău de acces: ${e.accessCode}

💰 Sumă plătită: ${e.amount} RON
⏰ Expiră: ${new Date(e.expiresAt).toLocaleDateString("ro-RO")}
🔗 Link LIVE: https://www.plipli9.com/live

Intră cu codul pe site și explorează paranormalul alături de Plipli9! 👻

--- Plipli9 Paranormal ---`,o={phoneNumber:e.phoneNumber,message:t,accessCode:e.accessCode},s=await fetch("https://hook.eu2.make.com/ida0ge74962m4ske2bw78ywj9szu54ie",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(8e3)});if(!s.ok)throw Error(`WhatsApp webhook failed: ${s.status} ${s.statusText}`);let a=await s.text();return console.log("\uD83D\uDCF1 WhatsApp webhook response:",a),{success:!0,response:a}}catch(e){return console.error("❌ WhatsApp notification error:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function p(e,t){try{if(!(await fetch(`${process.env.NEXT_PUBLIC_BASE_URL}/api/database/update-notifications`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({stripePaymentId:e,notificationsSent:!0,emailSuccess:t.email.success,whatsappSuccess:t.whatsapp.success,notificationResults:t,updatedAt:new Date().toISOString()})})).ok)throw Error("Failed to update notification status");console.log("✅ Notification status updated in database")}catch(e){throw console.error("❌ Failed to update notification status:",e),e}}let d=new a.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/notifications/send-all/route",pathname:"/api/notifications/send-all",filename:"route",bundlePath:"app/api/notifications/send-all/route"},resolvedPagePath:"C:\\Users\\user\\Desktop\\plipli paranormal\\app\\api\\notifications\\send-all\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:f,headerHooks:w,staticGenerationBailout:D}=d,g="/api/notifications/send-all/route";function C(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:h})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),s=t.X(0,[1638,6206],()=>o(41780));module.exports=s})();