"use strict";(()=>{var e={};e.id=2151,e.ids=[2151],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},73837:e=>{e.exports=require("util")},96493:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>w,originalPathname:()=>A,patchFetch:()=>S,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>v,staticGenerationAsyncStorage:()=>b,staticGenerationBailout:()=>_});var o={};r.r(o),r.d(o,{POST:()=>d});var n=r(95419),a=r(69108),s=r(99678),i=r(78070),c=r(91211),l=r(28290);let u=new c.Z("sk_test_placeholder_stripe_secret",{apiVersion:"2023-10-16"});async function d(e){let t;let r=await e.text(),o=(0,l.headers)().get("stripe-signature");try{t=u.webhooks.constructEvent(r,o,"whsec_placeholder_stripe_webhook")}catch(e){return console.error("❌ Stripe webhook signature verification failed"),i.Z.json({error:"Invalid signature"},{status:400})}if("checkout.session.completed"===t.type){let e=t.data.object;console.log("\uD83D\uDCB3 CHECKOUT COMPLETED - STARTING FULL CHAIN");let r=e.customer_email||e.customer_details?.email||"unknown@email.com",o=e.metadata?.phone_number||e.customer_details?.phone||"",n=(e.amount_total||0)/100,a=f(),s=p(),c={stripePaymentId:e.id,email:r,phoneNumber:o,amount:n,accessCode:a,status:"completed",expiresAt:s,createdAt:new Date().toISOString(),notificationsSent:!1,eventType:"checkout.session.completed"};return await y(c),await h(c),console.log("✅ FULL PAYMENT CHAIN COMPLETED"),i.Z.json({success:!0,message:"Checkout completed and notifications sent",accessCode:a})}if("payment_intent.succeeded"===t.type){let e=t.data.object;console.log("\uD83D\uDCB3 PAYMENT INTENT SUCCEEDED - BACKUP CHAIN");let r=e.receipt_email||e.metadata?.email||"backup@processing.com",o=e.metadata?.phone_number||"",n=e.amount/100,a=f(),s=p(),c={stripePaymentId:e.id,email:r,phoneNumber:o,amount:n,accessCode:a,status:"completed",expiresAt:s,createdAt:new Date().toISOString(),notificationsSent:!1,eventType:"payment_intent.succeeded"};return await y(c),await h(c),console.log("✅ BACKUP PAYMENT CHAIN COMPLETED"),i.Z.json({success:!0,message:"Payment intent processed and notifications sent",accessCode:a})}return i.Z.json({success:!0})}function f(){let e=Date.now().toString().slice(-6),t=Math.random().toString(36).substring(2,6).toUpperCase();return`PARA${e}${t}`}function p(){let e=new Date;return e.setDate(e.getDate()+1),e.setHours(6,0,0,0),e.toISOString()}async function y(e){try{if(!(await fetch(`${process.env.NEXT_PUBLIC_BASE_URL}/api/database/save-payment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Database save failed");console.log("\uD83D\uDCBE Payment saved to database")}catch(e){throw console.error("❌ Database save error:",e),e}}async function h(e){try{if(!(await fetch(`${process.env.NEXT_PUBLIC_BASE_URL}/api/notifications/send-all`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Notification chain failed");console.log("\uD83D\uDCF1 Notification chain triggered")}catch(e){console.error("❌ Notification chain error:",e)}}let g=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/webhooks/stripe-complete/route",pathname:"/api/webhooks/stripe-complete",filename:"route",bundlePath:"app/api/webhooks/stripe-complete/route"},resolvedPagePath:"C:\\Users\\user\\Desktop\\plipli paranormal\\app\\api\\webhooks\\stripe-complete\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:b,serverHooks:v,headerHooks:w,staticGenerationBailout:_}=g,A="/api/webhooks/stripe-complete/route";function S(){return(0,s.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:b})}},58284:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"DraftMode",{enumerable:!0,get:function(){return n}});let o=r(72973);class n{get isEnabled(){return this._provider.isEnabled}enable(){if(!(0,o.staticGenerationBailout)("draftMode().enable()"))return this._provider.enable()}disable(){if(!(0,o.staticGenerationBailout)("draftMode().disable()"))return this._provider.disable()}constructor(e){this._provider=e}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},28290:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{headers:function(){return u},cookies:function(){return d},draftMode:function(){return f}});let o=r(97366),n=r(3022),a=r(63608),s=r(54580),i=r(72934),c=r(72973),l=r(58284);function u(){if((0,c.staticGenerationBailout)("headers",{link:"https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering"}))return n.HeadersAdapter.seal(new Headers({}));let e=s.requestAsyncStorage.getStore();if(!e)throw Error("Invariant: headers() expects to have requestAsyncStorage, none available.");return e.headers}function d(){if((0,c.staticGenerationBailout)("cookies",{link:"https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering"}))return o.RequestCookiesAdapter.seal(new a.RequestCookies(new Headers({})));let e=s.requestAsyncStorage.getStore();if(!e)throw Error("Invariant: cookies() expects to have requestAsyncStorage, none available.");let t=i.actionAsyncStorage.getStore();return t&&(t.isAction||t.isAppRoute)?e.mutableCookies:e.cookies}function f(){let e=s.requestAsyncStorage.getStore();if(!e)throw Error("Invariant: draftMode() expects to have requestAsyncStorage, none available.");return new l.DraftMode(e.draftMode)}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},48096:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{DynamicServerError:function(){return o},isDynamicServerError:function(){return n}});let r="DYNAMIC_SERVER_USAGE";class o extends Error{constructor(e){super("Dynamic server usage: "+e),this.description=e,this.digest=r}}function n(e){return"object"==typeof e&&null!==e&&"digest"in e&&"string"==typeof e.digest&&e.digest===r}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},72973:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{isStaticGenBailoutError:function(){return i},staticGenerationBailout:function(){return l}});let o=r(48096),n=r(45869),a="NEXT_STATIC_GEN_BAILOUT";class s extends Error{constructor(...e){super(...e),this.code=a}}function i(e){return"object"==typeof e&&null!==e&&"code"in e&&e.code===a}function c(e,t){let{dynamic:r,link:o}=t||{};return"Page"+(r?' with `dynamic = "'+r+'"`':"")+" couldn't be rendered statically because it used `"+e+"`."+(o?" See more info here: "+o:"")}let l=(e,t)=>{let{dynamic:r,link:a}=void 0===t?{}:t,i=n.staticGenerationAsyncStorage.getStore();if(!i)return!1;if(i.forceStatic)return!0;if(i.dynamicShouldError)throw new s(c(e,{link:a,dynamic:null!=r?r:"error"}));let l=c(e,{dynamic:r,link:"https://nextjs.org/docs/messages/dynamic-server-error"});if(null==i.postpone||i.postpone.call(i,e),i.revalidate=0,i.isStaticGeneration){let t=new o.DynamicServerError(l);throw i.dynamicUsageDescription=e,i.dynamicUsageStack=t.stack,t}return!1};("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},3022:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{ReadonlyHeadersError:function(){return n},HeadersAdapter:function(){return a}});let o=r(6250);class n extends Error{constructor(){super("Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers")}static callable(){throw new n}}class a extends Headers{constructor(e){super(),this.headers=new Proxy(e,{get(t,r,n){if("symbol"==typeof r)return o.ReflectAdapter.get(t,r,n);let a=r.toLowerCase(),s=Object.keys(e).find(e=>e.toLowerCase()===a);if(void 0!==s)return o.ReflectAdapter.get(t,s,n)},set(t,r,n,a){if("symbol"==typeof r)return o.ReflectAdapter.set(t,r,n,a);let s=r.toLowerCase(),i=Object.keys(e).find(e=>e.toLowerCase()===s);return o.ReflectAdapter.set(t,i??r,n,a)},has(t,r){if("symbol"==typeof r)return o.ReflectAdapter.has(t,r);let n=r.toLowerCase(),a=Object.keys(e).find(e=>e.toLowerCase()===n);return void 0!==a&&o.ReflectAdapter.has(t,a)},deleteProperty(t,r){if("symbol"==typeof r)return o.ReflectAdapter.deleteProperty(t,r);let n=r.toLowerCase(),a=Object.keys(e).find(e=>e.toLowerCase()===n);return void 0===a||o.ReflectAdapter.deleteProperty(t,a)}})}static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"append":case"delete":case"set":return n.callable;default:return o.ReflectAdapter.get(e,t,r)}}})}merge(e){return Array.isArray(e)?e.join(", "):e}static from(e){return e instanceof Headers?e:new a(e)}append(e,t){let r=this.headers[e];"string"==typeof r?this.headers[e]=[r,t]:Array.isArray(r)?r.push(t):this.headers[e]=t}delete(e){delete this.headers[e]}get(e){let t=this.headers[e];return void 0!==t?this.merge(t):null}has(e){return void 0!==this.headers[e]}set(e,t){this.headers[e]=t}forEach(e,t){for(let[r,o]of this.entries())e.call(t,o,r,this)}*entries(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase(),r=this.get(t);yield[t,r]}}*keys(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase();yield t}}*values(){for(let e of Object.keys(this.headers)){let t=this.get(e);yield t}}[Symbol.iterator](){return this.entries()}}},6250:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ReflectAdapter",{enumerable:!0,get:function(){return r}});class r{static get(e,t,r){let o=Reflect.get(e,t,r);return"function"==typeof o?o.bind(e):o}static set(e,t,r,o){return Reflect.set(e,t,r,o)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}},97366:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{ReadonlyRequestCookiesError:function(){return a},RequestCookiesAdapter:function(){return s},getModifiedCookieValues:function(){return c},appendMutableCookies:function(){return l},MutableRequestCookiesAdapter:function(){return u}});let o=r(63608),n=r(6250);class a extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#cookiessetname-value-options")}static callable(){throw new a}}class s{static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"clear":case"delete":case"set":return a.callable;default:return n.ReflectAdapter.get(e,t,r)}}})}}let i=Symbol.for("next.mutated.cookies");function c(e){let t=e[i];return t&&Array.isArray(t)&&0!==t.length?t:[]}function l(e,t){let r=c(t);if(0===r.length)return!1;let n=new o.ResponseCookies(e),a=n.getAll();for(let e of r)n.set(e);for(let e of a)n.set(e);return!0}class u{static wrap(e,t){let r=new o.ResponseCookies(new Headers);for(let t of e.getAll())r.set(t);let a=[],s=new Set,c=()=>{var e;let n=null==fetch.__nextGetStaticStore?void 0:null==(e=fetch.__nextGetStaticStore.call(fetch))?void 0:e.getStore();if(n&&(n.pathWasRevalidated=!0),a=r.getAll().filter(e=>s.has(e.name)),t){let e=[];for(let t of a){let r=new o.ResponseCookies(new Headers);r.set(t),e.push(r.toString())}t(e)}};return new Proxy(r,{get(e,t,r){switch(t){case i:return a;case"delete":return function(...t){s.add("string"==typeof t[0]?t[0]:t[0].name);try{e.delete(...t)}finally{c()}};case"set":return function(...t){s.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.set(...t)}finally{c()}};default:return n.ReflectAdapter.get(e,t,r)}}})}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[1638,6206,7257,1211],()=>r(96493));module.exports=o})();