(()=>{var e={};e.id=7333,e.ids=[7333],e.modules={30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},58359:()=>{},93739:()=>{},19306:(e,t,n)=>{"use strict";n.r(t),n.d(t,{headerHooks:()=>D,originalPathname:()=>I,patchFetch:()=>T,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>w,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>C});var s={};n.r(s),n.d(s,{POST:()=>d,dynamic:()=>g});var o=n(95419),i=n(69108),r=n(99678),c=n(78070),a=n(55349),l=n(98239);let u=[],h=new Map;async function d(e){try{let{streamId:t,username:n,message:s,isStreamer:o}=await e.json();if(!t||!n||!s)return c.Z.json({error:"Missing required fields"},{status:400});if(!o){let e=function(e,t){if(/(.)\1{4,}/g.test(e))return"Prea multe caractere identice consecutive (max 4)";if(e.length>200)return"Mesaj prea lung (max 200 caractere)";let n=Date.now(),s=h.get(t);return s&&n-s<3e3?"Așteaptă 3 secunde \xeentre mesaje":null}(s.trim(),n);if(e)return c.Z.json({error:e},{status:429});h.set(n,Date.now())}let i=(0,a.Hz)({streamId:t,username:n,message:s.trim(),timestamp:new Date().toISOString(),type:o?"admin":"user",likes:0}),r=!1;"plipli9-paranormal-live"===t&&(r=await l.X.sendMessage(n,s.trim()));let d=u.filter(e=>e.streamId===t);if(d.length>100){let e=d.length-100;for(let n=0;n<e;n++){let e=u.findIndex(e=>e.streamId===t);-1!==e&&u.splice(e,1)}}return console.log(`💬 Chat message sent: ${n}: ${s}`),console.log(`🎮 Twitch forwarded: ${r?"SUCCESS":"DEMO MODE"}`),c.Z.json({success:!0,message:i,twitchForwarded:r})}catch(e){return console.error("Error sending chat message:",e),c.Z.json({error:"Failed to send message"},{status:500})}}let g="force-dynamic",p=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/chat/send/route",pathname:"/api/chat/send",filename:"route",bundlePath:"app/api/chat/send/route"},resolvedPagePath:"C:\\Users\\user\\Desktop\\plipli paranormal\\app\\api\\chat\\send\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:w,headerHooks:D,staticGenerationBailout:C}=p,I="/api/chat/send/route";function T(){return(0,r.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:f})}},55349:(e,t,n)=>{"use strict";n.d(t,{Hz:()=>r,_U:()=>c});let s=[],o=1,i=[{id:"demo-1",streamId:"plipli9-paranormal-live",username:"PLIPLI9",message:"Bună seara tuturor! \uD83D\uDC7B",timestamp:new Date().toISOString(),type:"admin",likes:0}];function r(e){let t={...e,id:o.toString()};s.push(t),o++;let n=s.filter(t=>t.streamId===e.streamId);if(n.length>100){let t=n.length-100;for(let n=0;n<t;n++){let t=s.findIndex(t=>t.streamId===e.streamId);-1!==t&&s.splice(t,1)}}return t}function c(e,t=50){return s.filter(t=>t.streamId===e).slice(-t).sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime())}0===s.length&&s.push(...i)},98239:(e,t,n)=>{"use strict";n.d(t,{X:()=>i});var s=n(15703);class o{configure(e,t,n){return this.config={botUsername:e||process.env.TWITCH_BOT_USERNAME||"plipli9_bot",oauth:t||process.env.TWITCH_OAUTH_TOKEN||"",channel:n||process.env.TWITCH_CHANNEL||"plipli9"},console.log(`🎮 Server bot configured for: #${this.config.channel}`),!!this.config.oauth}autoConfigureForProduction(){return this.config?.oauth?console.log("\uD83C\uDFAE Bot already configured"):(this.config={botUsername:"plipli9_bot",oauth:"oauth:ofmzemzx56e09fxzxanwaarmlpchj3",channel:"plipli9"},console.log(`🎮 AUTO-CONFIGURED for production: #${this.config.channel}`)),!0}async connect(){if(this.config?.oauth||this.autoConfigureForProduction(),!this.config?.oauth)return console.log("❌ Twitch bot not configured or missing OAuth token"),!1;if(this.isConnected)return console.log("✅ Already connected to Twitch IRC"),!0;try{return console.log("\uD83C\uDFAE Connecting to Twitch IRC from server..."),this.ws=new s.ZP("wss://irc-ws.chat.twitch.tv:443"),this.ws.on("open",()=>{console.log("\uD83D\uDD0C Server WebSocket connected to Twitch IRC"),this.authenticate()}),this.ws.on("message",e=>{this.handleMessage(e.toString())}),this.ws.on("close",()=>{console.log("\uD83D\uDD0C Disconnected from Twitch IRC"),this.isConnected=!1,this.scheduleReconnect()}),this.ws.on("error",e=>{console.error("❌ Twitch IRC WebSocket error:",e),this.isConnected=!1}),!0}catch(e){return console.error("❌ Failed to connect to Twitch IRC:",e),!1}}authenticate(){this.ws&&this.config&&(this.ws.send(`PASS ${this.config.oauth}`),this.ws.send(`NICK ${this.config.botUsername}`),this.ws.send(`JOIN #${this.config.channel}`),this.heartbeatInterval=setInterval(()=>{this.ws?.readyState===s.ZP.OPEN&&this.ws.send("PING :tmi.twitch.tv")},3e4))}handleMessage(e){for(let t of e.trim().split("\n"))console.log("\uD83D\uDCE5 Twitch IRC:",t),t.includes("001")?(this.isConnected=!0,console.log("✅ Successfully authenticated with Twitch IRC"),console.log(`🎯 Server bot active in channel: #${this.config?.channel}`)):t.startsWith("PING")?this.ws?.send("PONG :tmi.twitch.tv"):t.includes("NOTICE")&&t.includes("Login authentication failed")&&console.error("❌ Twitch authentication failed - check OAuth token")}async sendMessage(e,t){if(!this.isConnected||!this.ws||!this.config)return console.log("\uD83D\uDD04 Twitch not connected, message dropped:",`${e}: ${t}`),!1;try{let n=`${e.toUpperCase()}: ${t}`;return this.ws.send(`PRIVMSG #${this.config.channel} :${n}`),console.log(`🎮 ✅ Sent to Twitch #${this.config.channel}: ${n}`),!0}catch(e){return console.error("❌ Failed to send to Twitch:",e),!1}}scheduleReconnect(){this.reconnectTimeout||(console.log("\uD83D\uDD04 Scheduling Twitch IRC reconnection in 5 seconds..."),this.reconnectTimeout=setTimeout(()=>{this.reconnectTimeout=null,this.connect()},5e3))}getStatus(){return{connected:this.isConnected,configured:!!this.config?.oauth,channel:this.config?.channel||null,botUsername:this.config?.botUsername||null}}disconnect(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.ws&&(this.ws.close(),this.ws=null),this.isConnected=!1,console.log("\uD83D\uDD0C Disconnected from Twitch IRC")}constructor(){this.ws=null,this.isConnected=!1,this.config=null,this.reconnectTimeout=null,this.heartbeatInterval=null}}let i=new o;setTimeout(()=>{console.log("\uD83D\uDE80 Starting auto-connect to Twitch IRC..."),i.autoConfigureForProduction(),i.connect()},2e3)}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),s=t.X(0,[1638,6206,5703],()=>n(19306));module.exports=s})();