"use strict";(()=>{var e={};e.id=2952,e.ids=[2952],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},73837:e=>{e.exports=require("util")},92218:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>_,originalPathname:()=>y,patchFetch:()=>v,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>w});var a={};r.r(a),r.d(a,{GET:()=>d,POST:()=>p});var i=r(95419),s=r(69108),o=r(99678),n=r(78070),u=r(91211),l=r(95752);let c=new u.Z("sk_test_placeholder_stripe_secret",{apiVersion:"2023-10-16"});async function p(e){try{let{email:t,phone_number:r}=await e.json();if(!t||"string"!=typeof t)return n.Z.json({error:"Email valid este obligatoriu"},{status:400});let a=t.trim().toLowerCase();if(!(0,l.vV)(a))return n.Z.json({error:"Formatul email-ului este invalid"},{status:400});if(a.length>254)return n.Z.json({error:"Email-ul este prea lung (max 254 caractere)"},{status:400});let i=null;if(r){if("string"!=typeof r)return n.Z.json({error:"Numărul de telefon trebuie să fie text"},{status:400});if(i=r.replace(/[^\d+]/g,""),!/^\+?[1-9]\d{1,14}$/.test(i))return n.Z.json({error:"Formatul numărului de telefon este invalid (folosește formatul internațional)"},{status:400})}let s=e.headers.get("x-forwarded-for")||e.headers.get("remote-addr")||"unknown",o=await c.checkout.sessions.create({payment_method_types:["card"],line_items:[{price_data:{currency:"ron",product_data:{name:"\uD83D\uDD34 LIVE Paranormal - Acces 8 ore",description:"Acces complet la investigația paranormală LIVE cu Plipli9",images:["https://www.plipli9.com/paranormal-preview.jpg"]},unit_amount:2500},quantity:1}],mode:"payment",success_url:"https://www.plipli9.com/live?payment=success&session_id={CHECKOUT_SESSION_ID}",cancel_url:"https://www.plipli9.com/live?payment=canceled",customer_email:a,metadata:{email:a,phone_number:i||"",access_type:"live_paranormal",validity_hours:"8",client_ip:s,created_at:new Date().toISOString()}});return n.Z.json({sessionId:o.id,url:o.url})}catch(t){console.error("❌ Stripe checkout error:",t);let e="Eroare la procesarea plății. \xcencearcă din nou.";return"parameter_invalid_empty"===t.code?e="Date de plată invalide. Verifică datele introduse.":"amount_too_small"===t.code&&(e="Suma de plată este prea mică."),n.Z.json({error:e},{status:500})}}async function d(){return n.Z.json({service:"Stripe Checkout API",status:"active",test_mode:"sk_test_placeholder_stripe_secret".includes("test")?"TEST":"LIVE",price:"25 RON",access_duration:"8 hours",features:["Instant access code delivery","Email + WhatsApp notifications","Resilient to technical interruptions"]})}let m=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/payment/checkout/route",pathname:"/api/payment/checkout",filename:"route",bundlePath:"app/api/payment/checkout/route"},resolvedPagePath:"C:\\Users\\user\\Desktop\\plipli paranormal\\app\\api\\payment\\checkout\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:f,serverHooks:g,headerHooks:_,staticGenerationBailout:w}=m,y="/api/payment/checkout/route";function v(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},95752:(e,t,r)=>{function a(){let e=Date.now().toString(),t=Math.random().toString(36).substring(2,8).toUpperCase();return`PLI${e.slice(-3)}${t.slice(0,3)}`}function i(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}r.d(t,{Bm:()=>a,CW:()=>u,Iy:()=>o,s$:()=>n,vV:()=>i});let s=new Map;function o(e,t=5,r=6e4){let a=Date.now();Array.from(s.entries()).forEach(([e,t])=>{t.resetTime<a&&s.delete(e)});let i=s.get(e);return!i||i.resetTime<a?(s.set(e,{count:1,resetTime:a+r}),{allowed:!0,remaining:t-1,resetTime:a+r}):i.count>=t?{allowed:!1,remaining:0,resetTime:i.resetTime}:(i.count++,s.set(e,i),{allowed:!0,remaining:t-i.count,resetTime:i.resetTime})}function n(e){let t=e.headers.get("x-forwarded-for"),r=e.headers.get("x-real-ip"),a=e.headers.get("remote-addr"),i=t?.split(",")[0]?.trim()||r||a||"unknown",s=(e.headers.get("user-agent")||"unknown").substring(0,50);return`${i}:${s}`}function u(e){if("string"!=typeof e)return{isValid:!1,error:"Codul trebuie să fie string"};let t=e.trim().toUpperCase().replace(/[-\s]/g,"");return 0===t.length?{isValid:!1,error:"Cod de acces este obligatoriu"}:/^PLI\d{3}[A-Z]{3}$/.test(t)?{isValid:!0,sanitized:t}:{isValid:!1,error:"Format cod invalid (format așteptat: PLI123ABC)"}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,6206,7257,1211],()=>r(92218));module.exports=a})();